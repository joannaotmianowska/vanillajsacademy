<!DOCTYPE html>
<html>
<head>
	<title>API Cache</title>

	<style type="text/css">
		body {
			margin: 1em auto;
			max-width: 40em;
			width: 88%;
		}
	</style>
</head>
<body>

	<h1>API Cache</h1>
	<p><em><strong>The Scuttlebutt</strong>&mdash;the number one source for pirate news!</em></p>

	<div id="app">
		Loading...
	</div>

	<script>
        const url = "https://vanillajsacademy.com/api/pirates.json";
        let articles = ['abc', 'cde', 'efg'];

        const fetchArticlesFromAPI = async function() {
            console.log('api call')
            try {
                const res = await fetch(url);
                const data = await res.json();
                articles = data.articles;
            } catch (error) {
                console.error(error);
            }
        }

        const saveArticlesToLocalStorage = function() {
            if (articles.length === 0) return;

            const dataToSave = {
                data: articles,
                timestamp: new Date().getTime()
            }

            localStorage.setItem('pirateArticles', JSON.stringify(dataToSave));
        }

        const fetchArticlesFromLocalStorage = function() {
            return JSON.parse(localStorage.getItem('pirateArticles')) || null;
        }

        const isDataValid = function(saved, goodFor) {
            if (!saved || !saved.data || !saved.timestamp) return;

            const diff = new Date().getTime() - saved.timestamp;
            console.log(diff)
            return diff < goodFor;
        }

        const getNewestArticles = function() {
            console.log('getting newest')
            const savedArticles = fetchArticlesFromLocalStorage();

            if (isDataValid(savedArticles, 1000 * 60)) {
                console.log('valid data')
            } else {
                console.log('old data')
            }
        }

        // fetchArticlesFromAPI();
        saveArticlesToLocalStorage();
        // setInterval(getNewestArticles, 10000)


        // localStorage.removeItem('pirateArticles')
	</script>
</body>
</html>